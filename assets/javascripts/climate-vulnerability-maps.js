function createJobMap(data) {
  const colors = d3.scaleLinear()
    .domain([0, 1])
    .range(['#2c7bb6', '#d7191c']);
  const parkingMap = d3.select('.climate-map');
  const path = d3.geoPath().projection(null);
  parkingMap.append('g')
    .attr('class', 'climate-map__heat')
    .selectAll('path')
    .data(data)
    .enter()
    .append('path')
    .attr('fill', d => colors(d.properties.vul_ht))
    .attr('opacity', '0.8')
    .attr('d', path);
}

function addUpdateButtons() {
  d3.select('.toggle__heat').on('click', (d) => {
    updateJobMap('vul_ht');
  });

  d3.select('.toggle__flood').on('click', (d) => {
    updateJobMap('vul_fz');
  });

  d3.select('.toggle__core-flood').on('click', (d) => {
    updateJobMap('vul_8in');
  });

  d3.select('.toggle__future-flood').on('click', (d) => {
    updateJobMap('vul_339');
  });
}

function updateJobMap(attribute) {
  const colors = d3.scaleLinear()
    .domain([0, 1])
    .range(['#2c7bb6', '#d7191c']);
  d3.selectAll('.climate-map__heat > *')
    .attr('fill', data => colors(data.properties[attribute]))
}

function zoomed() {
  d3
    .selectAll('.climate-map__heat')
    .selectAll('path,circle')
    .attr('transform', d3.event.transform);
}

function addZoomToMaps() {
  const zoom = d3.zoom()
      .scaleExtent([1, 8])
      .on('zoom', zoomed);
  d3.select('.climate-map').call(zoom);
}

window.addEventListener('DOMContentLoaded', () => {
  Promise.all([
    d3.json('./assets/data/final-dataset-with-percentile-rank.json'),
  ]).then((data) => {
    const topology = topojson.feature(data[0], data[0].objects['layer1']);
    createJobMap(topology.features);
    addUpdateButtons();
    addZoomToMaps();
  });
});
