// const projection = d3.geoAlbers()
//   .scale(120000)
//   .rotate([71.057, 0])
//   .center([-0.021, 42.38])
//   .translate([960 / 2, 500 / 2]);

function createJobMap(data) {
  const colors = d3.scaleLinear()
    .domain([0, 1])
    .range(['yellow', 'red']);
  const parkingMap = d3.select('.climate-map');
  const path = d3.geoPath().projection(null);
  parkingMap.append('g')
    .attr('class', 'climate-map__heat')
    .selectAll('path')
    .data(data)
    .enter()
    .append('path')
    .attr('fill', d => colors(d.properties.vul_ht))
    .attr('opacity', '0.8')
    .attr('d', path);
}

function zoomed() {
  d3
    .selectAll('.climate-map__heat')
    .selectAll('path,circle')
    .attr('transform', d3.event.transform);
}

function addZoomToMaps() {
  const zoom = d3.zoom()
      .scaleExtent([1, 8])
      .on('zoom', zoomed);
  d3.select('.climate-map').call(zoom);
}

window.addEventListener('DOMContentLoaded', () => {
  Promise.all([
    d3.json('./assets/data/final-dataset-with-percentile-rank.json'),
  ]).then((data) => {
    const topology = topojson.feature(data[0], data[0].objects['layer1']);
    // debugger;
    createJobMap(topology.features);
    addZoomToMaps();
  });
});
